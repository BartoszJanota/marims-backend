<html>
    <head>
        <script src='socket.io/socket.io.js'></script>
        <script>
			console.log('Connecting to websocket at url ' + location.host + '/browser' + location.pathname);
            var socket = io.connect('http://' + location.host + '/browser' + location.pathname);
		
			var imageWidth = 500;
			var imageHeight = 700;
		
            var refresh = function(image) {
                if(image !== null && image !== undefined) {
                    var screen = document.getElementById('screen');
                    screen.onclick = function(event){
						if(event.pageX != 0 && event.pageY != 0) {
							var x = Math.floor(event.offsetX/event.srcElement.width*imageWidth);
							var y = Math.floor(event.offsetY/event.srcElement.height*imageHeight);
							console.log("click");
							socket.emit('click', {xPos: x, yPos: y});
						}
                    };
					screen.ondragstart = function(event){ 
						return false; 
					};
                    screen.src = 'data:image/jpg;base64,' + image;
                }
            };

            socket.on('refresh', function(data){
                console.log('Refreshing');
                if(data !== null && data !== undefined){
                    refresh(data.image);
                }
            });

            socket.on('start', function(){
                console.log('Starting');
            });
			
			this.init = function() {
				var screen = document.getElementById('screen');
				screen.onclick = function(event){
					if(event.pageX != 0 && event.pageY != 0) {
						var x = Math.floor(event.offsetX/event.srcElement.width*imageWidth);
						var y = Math.floor(event.offsetY/event.srcElement.height*imageHeight);
						socket.emit('click', {xPos: x, yPos: y});
					}
				};
				screen.ondragstart = function(event){ 
					return false; 
				};
			}
        </script>
    </head>

    <body onLoad="init()">
        <img id="screen" src="/image" style="height:90%;margin:0px auto;display:block"/>
    </body>
</html>